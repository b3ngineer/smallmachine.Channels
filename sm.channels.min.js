(function(e){function a(a,d){this._value=a;this._type=d;return this}a.prototype._name="Channel";a.prototype.forward=function(a,d){null!=this._value&&(d[this._value]=!0);for(var c in this)if(this.hasOwnProperty(c)&&!("function"===typeof this[c]||0===c.indexOf("_"))&&!0!==d[c]&&"function"===typeof this[c].publish)d[c]=!0,this[c].publish(a,d);if("undefined"!==typeof this._relatesTo)for(c=0;c<this._relatesTo.length;c++)"undefined"!==typeof this._relatesTo[c]._subscribers&&this.notify(a,this._relatesTo[c]._subscribers)};
a.prototype.unsubscribe=function(a){"undefined"!==typeof this._subscribers&&delete this._subscribers[a]};a.prototype.subscribe=function(a){"undefined"===typeof this._subscribers&&(this._subscribers={});var d=e.getGuid();"function"===typeof a?this._subscribers[d]={update:a,lifetime:1}:("undefined"===typeof a.lifecycle&&(a.lifetime=1),this._subscribers[d]=a);return d};a.prototype.notify=function(a,d){var c=!1,l={},k=0,g=[],b;for(b in d){var h=d[b].update(a);"undefined"!==typeof d[b]&&(0>=d[b].lifetime&&
this.unsubscribe(b),!0===h?c=!0:"function"===typeof h?(g.push(h),c=!0):h&&"function"===typeof h.update&&(l[e.getGuid()]=h,k++))}if(c){b=0===g.length;for(h=0;h<g.length;h++)!1===!g[h](a)&&(b=!0);!1===b&&(c=!1)}!1==c&&0<k&&this.notify(a,l)};a.prototype.publish=function(a,d){d=d||{};if("function"===typeof a&&(a=a(new e.type.AsyncResult(this)),"undefined"!==typeof a&&"undefined"!==typeof a._channel&&"function"===typeof a.publish))return this;if("undefined"===typeof this._subscribers)return this.forward(a,
d),this;this.notify(a,this._subscribers);this.forward(a,d);return this};a.prototype.addHelper=function(e,d,c){var l=a.prototype.publish,k=this;this[e]=function(){for(var a=[],b=0;b<arguments.length;b++)a.push(arguments[b]);if("undefined"!==typeof c)for(b=0;b<c-a.length;b++)a.push(null);return l.apply(k,[function(b){a.push(b);return d.apply(k,a)}])};return this};e.behavior.extendedBy(a)})(smallmachine);(function(e){var a=new e.Ontology("sm.channels");a.addTerm("thing");a.addTerm("user");a.addTerm("system");a.addTerm("action");a.addTerm("click");a.addTerm("doubleClick");a.addTerm("keyPress");a.addTerm("task");a.addTerm("initialize");a.addTerm("insert");a.addTerm("remove");a.addTerm("get");a.addTerm("set");a.addTerm("messenger");a.addTerm("success");a.addTerm("error");a.addTerm("performs");a.addTerm("reactsTo");a.user.isA(a.thing);a.user.relatesTo(a.performs,a.action);a.system.isA(a.thing);a.system.relatesTo(a.performs,
a.task);a.messenger.isA(a.thing);a.click.isA(a.action);a.doubleClick.isA(a.action);a.keyPress.isA(a.action);a.get.isA(a.task);a.set.isA(a.task);a.success.isA(a.messenger);a.error.isA(a.messenger);a.initialize.isA(a.task);a.insert.isA(a.task);a.remove.isA(a.task);a.performs.hasRange(a.action).hasRange(a.task);a.reactsTo.hasRange(a.action).hasDomain(a.system);a.registerActivator(function(a){function c(b,c,g){if("undefined"!==typeof jQuery)try{jQuery.ajax({dataType:"json",url:b,type:"GET",success:function(c,
h,f){a.messenger.success.publish(h);g.publish(new e.type.NamedValue("sm.channels",b,c))},error:function(a,b,d){c?c(a,b,d):e.error(Error(d))}})}catch(k){e.error(Error(k))}else{var f=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");f.onprogress=function(){};f.onerror={};f.onreadystatechange=function(){4>f.readyState||(200==f.status?(a.messenger.success.publish(f.statusText),g.publish(new e.type.NamedValue("sm.channels",b,JSON.parse(f.responseText)))):e.error(Error(f.statusText)))};
f.open("GET",b,!0);f.setRequestHeader("X-Requested-With","XMLHttpRequest");f.setRequestHeader("Content-type","application/json");f.send(null)}return g}var l={update:function(b){return"undefined"!==typeof b.key&&"undefined"!==typeof b.namespace?function(b){a.memory.modify(b)}:!1}};e.alsoBehavesLike(a,{memory:new e.type.NamedValueCollection});a.set.subscribe({update:function(a){return l}});var k={update:function(b){return"undefined"!==typeof b.key&&"undefined"!==typeof b.namespace?function(b){a.memory.getValue(b)}:
!1}};a.get.subscribe({update:function(a){return k}});"function"===typeof a.initialize.addHelper&&a.initialize.addHelper("json",c,2);"function"===typeof a.set.addHelper&&a.set.addHelper("config",function(a){return new e.type.NamedValue("sm.channels","config",a)});if("function"===typeof a.get.addHelper){a.get.addHelper("json",c,2);var g=function(){this.namespace="sm.channels";this.key="config";return this};g.prototype._name="Config";g.prototype.setValue=function(a){e.alsoBehavesLike(this,a)};e.type.extendedBy(g);
a.get.addHelper("config",function(a){return a})}});try{e.ontology.extendedBy(a)}catch(m){e.error(Error("Could not extend the smallmachine.ontology property with the 'sm.channels' ontology: "+m.message+"\n"+m.stack))}})(smallmachine);
